{% extends 'Backend/Master/Base.twig' %}

{% block title %}{{ NAME }} - {{ TITLE }}{% endblock %}

{% block head %}

    {{ parent() }}

    <link rel="stylesheet" href="{{ GLOBAL_COMPONENTS }}datatables/media/css/dataTables.bootstrap.min.css" type="text/css" />

{% endblock %}

{% block content %}

    {% if PROVIDER == 'DEFAULT' %}
    <div class="navbar-lower">
        <div class="cbn-action style-underline">

            <nav>
                <ul>
                    <li class=""><a href="{{ urlFor( 'globalSetting' ) }}" class="fa fa-wrench"> <span>Global Settings</span></a></li>
                    <li class="active"><a href="{{ urlFor( 'users' ) }}" class="fa fa-group"> <span>User Auth &amp; Role Manager</span></a></li>
                    {% if ROLE == 7 %}
                        <li class=""><a href="{{ urlFor( 'allAuditTrails' ) }}" class="fa fa-list"> <span>Simple Audit Trails</span></a></li>
                    {% endif %}
                </ul>
            </nav>

        </div><!-- /tabs -->
    </div>
    {% endif %}
    <div class="container{% if CONTENT_FLUID %}-fluid{% endif %}">
        <!-- Page Heading -->
        <div class="row page-header">
            <div class="col-lg-12">
                <ol class="breadcrumb">
                    <li>
                        <i class="fa fa-dashboard"></i>  <a href="{{ urlFor( 'dashboard' ) }}">Dashboard</a>
                    </li>
                    <li class="active">
                        <i class="fa fa-group"></i> User Auth &amp; Role Manager
                    </li>
                </ol>
            </div>
        </div>

        {% if PERMISSION %}

            <!-- /.row -->
            <div class="row">

                <div class="col-lg-12">

                    <div class="panel panel-default">

                        <div class="panel-body">
                            <!-- Nav tabs -->
                            <ul class="nav nav-tabs"> <!-- Nav tabs/pills -->
                                <li class="active"><a href="#users" data-toggle="tab">User Auth Managers</a></li>
                                {% if ROLE == 7 %}
                                    <li><a href="#roles" data-toggle="tab">Role Managers</a></li>
                                {% endif %}
                            </ul>

                            <!-- Tab panes -->
                            <div class="tab-content">

                                <div class="tab-pane fade in active" id="users">

                                    <br />

                                    <div class="panel panel-default">
                                        {% if ROLE == 7 %}
                                            <div class="panel-heading">
                                                <a href="#" role="button" class="btn btn-primary" data-toggle="modal" data-target="#addUser" rel="tooltip" data-placement="right" title="This action needs user activations by Email !"><i class="fa fa-plus"></i> Add New User Administrator</a>
                                            </div>
                                            <!-- /.panel-heading -->
                                        {% endif %}
                                        <div class="panel-body">
                                            <div class="dataTable_wrapper">
                                                <table class="table table-striped table-bordered table-hover" id="all-users">
                                                    <thead>
                                                    <tr>
                                                        <th>Username</th>
                                                        <th>Email Address</th>
                                                        <th class="cbn-table-center">Role</th>
                                                        <th class="cbn-table-center">Status</th>
                                                        <th class="cbn-table-center">Action</th>
                                                    </tr>
                                                    </thead>
                                                    <tbody>
                                                    {% if ALL_USERS|length > 0 %}
                                                        {% for user in ALL_USERS %}
                                                            <tr>
                                                                <td>{{ user.user_name|e }}</td>
                                                                <td>{{ user.user_email|e }}</td>
                                                                <td class="cbn-table-center">

                                                                    {% if user.user_account_type == 7 %}
                                                                        <span class="label label-success">Root</span>&nbsp;
                                                                    {% endif %}
                                                                    <span class="label label-primary">{{ user.role_name }}</span>

                                                                </td>
                                                                <td class="cbn-table-center">
                                                                    {% if user.user_active == 0 %}
                                                                        <span class="label label-danger">Not Active</span>
                                                                    {% else %}
                                                                        <span class="label label-success">Active</span>
                                                                    {% endif %}
                                                                    {% if user.user_deleted == 1 %} <span class="label label-danger">Banned</span> {% endif %}
                                                                    {% if user.user_suspension_timestamp %} <span class="label label-danger">Suspended for {{ ( ( user.user_suspension_timestamp - date().timestamp) / 60 / 60 )|number_format(2, '.', ',') }} hours </span> {% endif %}
                                                                </td>
                                                                <td class="cbn-table-center">
                                                                    {% if user.user_provider_type == "DEFAULT" %}
                                                                        <a href="{{ urlFor( 'users' ) }}{{ user.user_id|e }}" class="btn btn-primary" rel="tooltip" data-placement="top" title="View User profile"><i class="fa fa-search"></i></a>
                                                                    {% endif %}
                                                                    {% if ( user.user_id != ID and ROLE == 7 ) %}
                                                                        <a href="#" role="button" class="btn btn-warning" data-toggle="modal" data-target="#suspendUser{{ user.user_id|e }}" rel="tooltip" data-placement="top" title="Suspend / Un-suspend User"><i class="fa fa-exclamation-circle"></i></a>
                                                                        {% if ( user.user_provider_type == "DEFAULT" ) %}
                                                                            {% if ( user.user_account_type != 7 ) %}
                                                                                <a href="#" role="button" class="btn btn-default" data-toggle="modal" data-target="#rootUser{{ user.user_id|e }}" rel="tooltip" data-placement="top" title="Make as Root"><i class="fa fa-lock"></i></a>
                                                                            {% else %}
                                                                                <a href="#" role="button" class="btn btn-default" data-toggle="modal" data-target="#rootUser{{ user.user_id|e }}" rel="tooltip" data-placement="top" title="Make as Normal Admin"><i class="fa fa-unlock"></i></a>
                                                                            {% endif %}
                                                                        {% endif %}
                                                                        {% if ( user.user_id != ID and user.user_provider_type == "DEFAULT" ) %}
                                                                            <a href="#" role="button" class="btn btn-info" data-toggle="modal" data-target="#roleUser{{ user.user_id|e }}" rel="tooltip" data-placement="top" title="Change User Role for Admin only"><i class="fa fa-certificate"></i></a>
                                                                        {% endif %}
                                                                        <a href="#" role="button" class="btn btn-danger" data-toggle="modal" data-target="#banUser{{ user.user_id|e }}" rel="tooltip" data-placement="top" title="Ban / Un-ban User"><i class="fa fa-ban"></i></a>
                                                                    {% endif %}

                                                                </td>
                                                            </tr>

                                                            <!-- Suspend User Modal -->
                                                            <div class="modal fade" id="suspendUser{{ user.user_id|e }}" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
                                                                <div class="modal-dialog">
                                                                    <div class="modal-content">
                                                                        <div class="modal-header">
                                                                            <a class="close" data-dismiss="modal" aria-hidden="true">&times;</a>
                                                                            <h4 class="modal-title" id="myModalLabel">Suspend / Un-suspend User : {{ user.user_email|e }}</h4>
                                                                        </div>

                                                                        <form action="{{ urlFor( 'suspendUserAction' ) }}" method="post" role="form">
                                                                            {% if user.user_suspension_timestamp %}
                                                                                <div class="modal-body">

                                                                                    <div class="form-group">
                                                                                        <h5>Are you sure want to un-suspend {{ user.user_email|e }} ?</h5>
                                                                                        <p class="help-block">This user can login again !</p>
                                                                                    </div>

                                                                                    <input type="hidden" name="user_id" value="{{ user.user_id|e }}">

                                                                                </div>
                                                                                <div class="modal-footer">

                                                                                    <a class="btn btn-danger" data-dismiss="modal">No</a>
                                                                                    <button type="submit" class="btn btn-success">Yes</button>

                                                                                </div>
                                                                            {% else %}
                                                                                <div class="modal-body">

                                                                                    <label for="suspension">Suspension Time in Days</label>

                                                                                    <div class="form-group input-group">
                                                                                        <input id="suspension" type="number" min="0" max="30" name="suspension" class="form-control" required/>
                                                                                        <span class="input-group-addon">Days</span>
                                                                                    </div>

                                                                                    <input type="hidden" name="user_id" value="{{ user.user_id|e }}">

                                                                                </div>
                                                                                <div class="modal-footer">

                                                                                    <a class="btn btn-danger" data-dismiss="modal">Close</a>
                                                                                    <button type="submit" class="btn btn-success pull-left">Submit</button>

                                                                                </div>
                                                                            {% endif %}
                                                                            <input type="hidden" name="{{ CSRF_TOKEN_NAME }}" value="{{ CSRF_TOKEN_VALUE }}"/>

                                                                        </form>

                                                                    </div>
                                                                    <!-- /.modal-content -->
                                                                </div>
                                                                <!-- /.modal-dialog -->
                                                            </div>
                                                            <!-- /.modal -->

                                                            <!-- Rooting User Modal -->
                                                            <div class="modal fade" id="rootUser{{ user.user_id|e }}" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
                                                                <div class="modal-dialog">
                                                                    <div class="modal-content">
                                                                        <div class="modal-header">
                                                                            <a class="close" data-dismiss="modal" aria-hidden="true">&times;</a>
                                                                            <h4 class="modal-title" id="myModalLabel">Make User as ROOT / NORMAL : {{ user.user_email|e }}</h4>
                                                                        </div>

                                                                        <form action="{{ urlFor( 'rootUserAction' ) }}" method="post" role="form">
                                                                            {% if user.user_account_type == 7 %}
                                                                                <div class="modal-body">

                                                                                    <div class="form-group">
                                                                                        <h5>Are you sure want to un-ROOT {{ user.user_email|e }} ?</h5>
                                                                                        <p class="help-block">This user can not access ROOT modules !</p>
                                                                                    </div>

                                                                                    <input type="hidden" name="rooting" value="off">
                                                                                    <input type="hidden" name="user_id" value="{{ user.user_id|e }}">

                                                                                </div>
                                                                                <div class="modal-footer">

                                                                                    <a class="btn btn-danger" data-dismiss="modal">No</a>
                                                                                    <button type="submit" class="btn btn-success">Yes</button>

                                                                                </div>
                                                                            {% else %}
                                                                                <div class="modal-body">

                                                                                    <div class="form-group">
                                                                                        <h5>Are you sure want to make as ROOT {{ user.user_email|e }} ?</h5>
                                                                                        <p class="help-block">This user can access ROOT modules !</p>
                                                                                    </div>

                                                                                    <input type="hidden" name="rooting" value="on">
                                                                                    <input type="hidden" name="user_id" value="{{ user.user_id|e }}">

                                                                                </div>
                                                                                <div class="modal-footer">

                                                                                    <a class="btn btn-danger" data-dismiss="modal">No</a>
                                                                                    <button type="submit" class="btn btn-success pull-left">Yes</button>

                                                                                </div>
                                                                            {% endif %}

                                                                            <input type="hidden" name="{{ CSRF_TOKEN_NAME }}" value="{{ CSRF_TOKEN_VALUE }}"/>

                                                                        </form>

                                                                    </div>
                                                                    <!-- /.modal-content -->
                                                                </div>
                                                                <!-- /.modal-dialog -->
                                                            </div>
                                                            <!-- /.modal -->

                                                            <!-- Role User Modal -->
                                                            <div class="modal fade" id="roleUser{{ user.user_id|e }}" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
                                                                <div class="modal-dialog">
                                                                    <div class="modal-content">
                                                                        <div class="modal-header">
                                                                            <a class="close" data-dismiss="modal" aria-hidden="true">&times;</a>
                                                                            <h4 class="modal-title" id="myModalLabel">Change User Role : {{ user.user_email|e }}</h4>
                                                                        </div>

                                                                        <form action="{{ urlFor( 'roleUserAction' ) }}" method="post" role="form">
                                                                            <div class="modal-body">

                                                                                <div class="form-group">
                                                                                    <label for="role_id">Select Role:</label>
                                                                                    <select name="role_id" id="role_id" class="form-control">
                                                                                        {% for role in ALL_ADMIN_ROLES %}
                                                                                            <option name="role_id" id="role_id" value="{{ role.role_id|e }}" {% if ( user.role_id == role.role_id ) %} selected {% endif %}>{{ role.role_name|e }}</option>
                                                                                        {% endfor %}
                                                                                    </select>
                                                                                </div>

                                                                                <input type="hidden" name="user_id" value="{{ user.user_id|e }}">

                                                                            </div>
                                                                            <div class="modal-footer">

                                                                                <a class="btn btn-danger" data-dismiss="modal">Cancel</a>
                                                                                <button type="submit" class="btn btn-success pull-left">Change Role</button>

                                                                            </div>

                                                                            <input type="hidden" name="{{ CSRF_TOKEN_NAME }}" value="{{ CSRF_TOKEN_VALUE }}"/>

                                                                        </form>

                                                                    </div>
                                                                    <!-- /.modal-content -->
                                                                </div>
                                                                <!-- /.modal-dialog -->
                                                            </div>
                                                            <!-- /.modal -->

                                                            <!-- Ban User Modal -->
                                                            <div class="modal fade" id="banUser{{ user.user_id|e }}" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
                                                                <div class="modal-dialog">
                                                                    <div class="modal-content">
                                                                        <div class="modal-header">
                                                                            <a class="close" data-dismiss="modal" aria-hidden="true">&times;</a>
                                                                            <h4 class="modal-title" id="myModalLabel">Ban / Un-ban User : {{ user.user_email|e }}</h4>
                                                                        </div>

                                                                        <form action="{{ urlFor( 'banUserAction' ) }}" method="post" role="form">
                                                                            {% if user.user_deleted == 1 %}
                                                                                <div class="modal-body">

                                                                                    <div class="form-group">
                                                                                        <h5>Are you sure want to un-ban {{ user.user_email|e }} ?</h5>
                                                                                        <p class="help-block">This user can login again !</p>
                                                                                    </div>

                                                                                    <input type="hidden" name="softDelete" value="off">
                                                                                    <input type="hidden" name="user_id" value="{{ user.user_id|e }}">

                                                                                </div>
                                                                                <div class="modal-footer">

                                                                                    <a class="btn btn-danger" data-dismiss="modal">No</a>
                                                                                    <button type="submit" class="btn btn-success pull-left">Yes</button>

                                                                                </div>
                                                                            {% else %}
                                                                                <div class="modal-body">

                                                                                    <div class="form-group">
                                                                                        <h5>Are you sure want to ban {{ user.user_email|e }} ?</h5>
                                                                                        <p class="help-block">This user cannot login until un-banned !</p>
                                                                                    </div>

                                                                                    <input type="hidden" name="softDelete" value="on">
                                                                                    <input type="hidden" name="user_id" value="{{ user.user_id|e }}">

                                                                                </div>
                                                                                <div class="modal-footer">

                                                                                    <a class="btn btn-danger" data-dismiss="modal">No</a>
                                                                                    <button type="submit" class="btn btn-success pull-left">Yes</button>

                                                                                </div>
                                                                            {% endif %}

                                                                            <input type="hidden" name="{{ CSRF_TOKEN_NAME }}" value="{{ CSRF_TOKEN_VALUE }}"/>

                                                                        </form>

                                                                    </div>
                                                                    <!-- /.modal-content -->
                                                                </div>
                                                                <!-- /.modal-dialog -->
                                                            </div>
                                                            <!-- /.modal -->

                                                        {% endfor %}
                                                    {% endif %}
                                                    </tbody>
                                                </table>
                                            </div>
                                            <!-- /.table-responsive -->
                                        </div>
                                        <!-- /.panel-body -->
                                    </div>
                                    <!-- /.panel -->

                                </div>

                                <div class="tab-pane fade in" id="roles">
                                    <br />

                                    <div class="panel panel-default">
                                        {% if ROLE == 7 %}
                                            <div class="panel-heading">
                                                <a href="#" role="button" class="btn btn-primary" data-toggle="modal" data-target="#addRole" rel="tooltip" data-placement="right" title=""><i class="fa fa-plus"></i> Add New Role</a>
                                            </div>
                                            <!-- /.panel-heading -->
                                        {% endif %}
                                        <div class="panel-body">
                                            <div class="dataTable_wrapper">
                                                <table class="table table-striped table-bordered table-hover" id="all-roles">
                                                    <thead>
                                                    <tr>
                                                        <th>Role Name</th>
                                                        <th>Role Descriptions</th>
                                                        <th class="cbn-table-center">Role Permission [ 1 => TRUE , 0 => FALSE ]</th>
                                                        {% if ( ROLE == 7 ) %}
                                                            <th class="cbn-table-center">Action</th>
                                                        {% endif %}
                                                    </tr>
                                                    </thead>
                                                    <tbody>
                                                    {% if ALL_ROLES|length > 0 %}
                                                        {% for role in ALL_ROLES %}
                                                            <tr>
                                                                <td>
                                                                    {{ role.role_name|e }}
                                                                    {% if role.register_default|e == 1 %}
                                                                        <span class="label label-default">Default for Public Registration</span>
                                                                    {% endif %}
                                                                    {% if role.admin_default|e == 1 %}
                                                                        <span class="label label-success">Default for Admin Registration</span>
                                                                    {% endif %}
                                                                    {% if role.patient_default|e == 1 %}
                                                                        <span class="label label-primary">Default for Patient Registration</span>
                                                                    {% endif %}
                                                                    {% if role.dentist_default|e == 1 %}
                                                                        <span class="label label-info">Default for Dentist Registration</span>
                                                                    {% endif %}
                                                                </td>
                                                                <td>{{ role.role_desc|e }}</td>
                                                                <td class="cbn-table-center">
                                                                    {{ role.role_permission|e }}
                                                                </td>
                                                                {% if ( ROLE == 7 ) %}
                                                                    <td class="cbn-table-center">

                                                                            <a href="#" role="button" class="btn btn-warning" data-toggle="modal" data-target="#updateRole{{ role.role_id|e }}" rel="tooltip" data-placement="top" title="Update User Role"><i class="fa fa-pencil"></i></a>
                                                                            {% if not role.register_default|e and not role.admin_default and not role.dentist_default and not role.patient_default %}
                                                                                <a href="#" role="button" class="btn btn-danger" data-toggle="modal" data-target="#deleteRole{{ role.role_id|e }}" rel="tooltip" data-placement="top" title="Delete User Role"><i class="fa fa-ban"></i></a>
                                                                            {% endif %}

                                                                    </td>
                                                                {% endif %}
                                                            </tr>

                                                            <!-- Update Role Modal -->
                                                            <div class="modal fade" id="updateRole{{ role.role_id|e }}" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
                                                                <div class="modal-dialog">
                                                                    <div class="modal-content">
                                                                        <div class="modal-header">
                                                                            <a class="close" data-dismiss="modal" aria-hidden="true">&times;</a>
                                                                            <h4 class="modal-title" id="myModalLabel">Update Role : {{ role.role_name|e }}</h4>
                                                                        </div>

                                                                        <form action="{{ urlFor( 'updateRoleAction' ) }}" method="post" role="form">

                                                                            <div class="modal-body">

                                                                                <div class="form-group">
                                                                                    <label for="role_name">Role Name</label>
                                                                                    <input id="role_name" class="form-control" type="text" name="role_name" value="{{ role.role_name|e }}" readonly>
                                                                                </div>

                                                                                <div class="form-group">
                                                                                    <label for="role_desc">Role Description</label>
                                                                                    <textarea name="role_desc" id="role_desc" class="form-control" rows="3">{{ role.role_desc|e }}</textarea>
                                                                                </div>

                                                                                {{ role.role_permission['dashboard'] }}

                                                                                <div class="form-group">

                                                                                    <label for="role_permission">Role Permissions</label>
                                                                                    <br />
                                                                                    <label><input name="role_permission_dashboard" id="role_permission" type="checkbox" {% if role.role_permission_dashboard == 1 %}checked{% endif %}>Dashboard</label><br />
                                                                                    <label><input name="role_permission_patient" id="role_permission" type="checkbox" {% if role.role_permission_patient == 1 %}checked{% endif %}>Patient Managers</label><br />
                                                                                    <label><input name="role_permission_dentist" id="role_permission" type="checkbox" {% if role.role_permission_dentist == 1 %}checked{% endif %}>Dentist Managers</label><br />
                                                                                    <label><input name="role_permission_appointment" id="role_permission" type="checkbox" {% if role.role_permission_appointment == 1 %}checked{% endif %}>Appointment Managers</label><br />
                                                                                    <label><input name="role_permission_global_settings" id="role_permission" type="checkbox" {% if role.role_permission_global_settings == 1 %}checked{% endif %}>Global Settings</label><br />
                                                                                    <label><input name="role_permission_user_managers" id="role_permission" type="checkbox" {% if role.role_permission_user_managers == 1 %}checked{% endif %}>User &amp; Role Managers</label><br />
                                                                                    <label><input name="role_permission_audit_trails" id="role_permission" type="checkbox" {% if role.role_permission_audit_trails == 1 %}checked{% endif %}>Audit Trails</label><br />

                                                                                </div>

                                                                                <input type="hidden" name="role_id" value="{{ role.role_id|e }}">

                                                                            </div>
                                                                            <div class="modal-footer">

                                                                                <a class="btn btn-danger" data-dismiss="modal">Cancel</a>
                                                                                <button type="submit" class="btn btn-success pull-left">Submit</button>

                                                                            </div>

                                                                            <input type="hidden" name="{{ CSRF_TOKEN_NAME }}" value="{{ CSRF_TOKEN_VALUE }}"/>

                                                                        </form>

                                                                    </div>
                                                                    <!-- /.modal-content -->
                                                                </div>
                                                                <!-- /.modal-dialog -->
                                                            </div>
                                                            <!-- /.modal -->

                                                            <!-- Delete Role Modal -->
                                                            <div class="modal fade" id="deleteRole{{ role.role_id|e }}" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
                                                                <div class="modal-dialog">
                                                                    <div class="modal-content">
                                                                        <div class="modal-header">
                                                                            <a class="close" data-dismiss="modal" aria-hidden="true">&times;</a>
                                                                            <h4 class="modal-title" id="myModalLabel">Delete Role : {{ role.role_name|e }}</h4>
                                                                        </div>

                                                                        <form action="{{ urlFor( 'deleteRoleAction' ) }}" method="post" role="form">
                                                                            <div class="modal-body">

                                                                                <div class="form-group">
                                                                                    <h5>Are you sure want to delete role {{ role.role_name|e }} ?</h5>
                                                                                    <p class="help-block">Please check user association first !</p>
                                                                                </div>

                                                                                <input type="hidden" name="role_id" value="{{ role.role_id|e }}">

                                                                            </div>
                                                                            <div class="modal-footer">

                                                                                <a class="btn btn-danger" data-dismiss="modal">No</a>
                                                                                <button type="submit" class="btn btn-success pull-left">Yes</button>

                                                                            </div>

                                                                            <input type="hidden" name="{{ CSRF_TOKEN_NAME }}" value="{{ CSRF_TOKEN_VALUE }}"/>

                                                                        </form>

                                                                    </div>
                                                                    <!-- /.modal-content -->
                                                                </div>
                                                                <!-- /.modal-dialog -->
                                                            </div>
                                                            <!-- /.modal -->

                                                        {% endfor %}
                                                    {% endif %}
                                                    </tbody>
                                                </table>
                                            </div>
                                            <!-- /.table-responsive -->
                                        </div>
                                        <!-- /.panel-body -->
                                    </div>
                                    <!-- /.panel -->

                                </div>

                            </div>
                        </div>
                        <!-- /.panel-body -->
                    </div>
                    <!-- /.panel -->

                </div>
            </div>

            <!-- Add New User Modal -->
            <div class="modal fade" id="addUser" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
                <div class="modal-dialog">
                    <div class="modal-content">
                        <div class="modal-header">
                            <a class="close" data-dismiss="modal" aria-hidden="true">&times;</a>
                            <h4 class="modal-title" id="myModalLabel">Add New User Administrator</h4>
                        </div>

                        <form action="{{ urlFor( 'addUserAction' ) }}" method="post" role="form">

                            <div class="modal-body">

                                <div class="form-group">
                                    <label for="user_email">Email Address</label>
                                    <input id="user_email" class="form-control" type="text" name="user_email" required>
                                    <p class="help-block">Please provide an valid Email Address !</p>
                                </div>

                                <div class="form-group">
                                    <label for="user_role">User Role ?</label>
                                    <select name="user_role" id="user_role" class="form-control">
                                        {% for role in ALL_ADMIN_ROLES %}
                                            <option value="{{ role.role_id|e }}">{{ role.role_name|e }}</option>
                                        {% endfor %}
                                    </select>
                                </div>

                                <label>Username</label>
                                <div class="form-group input-group">
                                    <span class="input-group-addon">@</span>
                                    <input type="text" class="form-control" pattern="[a-zA-Z0-9]{2,64}" name="user_name" placeholder="Username (letters/numbers, 2-64 chars)" required>
                                </div>

                                <div class="form-group">
                                    <label for="user_password_new">Password</label>
                                    <input type="text" class="form-control" name="user_password_new" pattern=".{6,}" placeholder="Password (6+ characters)" required autocomplete="off">
                                </div>

                                <div class="form-group">
                                    <label for="user_password_repeat">Repeat Password</label>
                                    <input type="password" class="form-control" name="user_password_repeat" pattern=".{6,}" required placeholder="Repeat your password" autocomplete="off">
                                </div>

                                <input type="hidden" name="user_account_type" value="1">

                            </div>
                            <div class="modal-footer">

                                <a class="btn btn-danger" data-dismiss="modal">Cancel</a>
                                <button type="submit" class="btn btn-success pull-left">Submit</button>

                            </div>

                            <input type="hidden" name="{{ CSRF_TOKEN_NAME }}" value="{{ CSRF_TOKEN_VALUE }}"/>

                        </form>

                    </div>
                    <!-- /.modal-content -->
                </div>
                <!-- /.modal-dialog -->
            </div>
            <!-- /.modal -->

            <!-- Add New Role Modal -->
            <div class="modal fade" id="addRole" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
                <div class="modal-dialog">
                    <div class="modal-content">
                        <div class="modal-header">
                            <a class="close" data-dismiss="modal" aria-hidden="true">&times;</a>
                            <h4 class="modal-title" id="myModalLabel">Add New User Role</h4>
                        </div>

                        <form action="{{ urlFor( 'addRoleAction' ) }}" method="post" role="form">

                            <div class="modal-body">

                                <div class="form-group">
                                    <label for="role_name">Role Name</label>
                                    <input id="role_name" class="form-control" type="text" name="role_name" required>
                                </div>

                                <div class="form-group">
                                    <label for="role_desc">Role Description</label>
                                    <textarea name="role_desc" id="role_desc" class="form-control" rows="3"></textarea>
                                </div>

                                <div class="form-group">

                                    <label for="role_permission">Role Permissions</label>
                                    <br />
                                    <label><input name="role_permission_dashboard" id="role_permission" type="checkbox">Dashboard</label><br />
                                    <label><input name="role_permission_patient" id="role_permission" type="checkbox">Patient Managers</label><br />
                                    <label><input name="role_permission_dentist" id="role_permission" type="checkbox">Dentist Managers</label><br />
                                    <label><input name="role_permission_appointment" id="role_permission" type="checkbox">Appointment Managers</label><br />
                                    <label><input name="role_permission_global_settings" id="role_permission" type="checkbox">Global Settings</label><br />
                                    <label><input name="role_permission_user_managers" id="role_permission" type="checkbox">User &amp; Role Managers</label><br />
                                    <label><input name="role_permission_audit_trails" id="role_permission" type="checkbox">Audit Trails</label><br />
                                    {#<label><input name="role_permission[]" id="role_permission" type="checkbox" value="">User &amp; Role Managers</label> :#}
                                    {#<label>Create <input type="checkbox" value=""></label> |#}
                                    {#<label>Read <input type="checkbox" value=""></label> |#}
                                    {#<label>Update <input type="checkbox" value=""></label> |#}
                                    {#<label>Delete <input type="checkbox" value=""></label><br />#}

                                </div>

                            </div>
                            <div class="modal-footer">

                                <a class="btn btn-danger" data-dismiss="modal">Cancel</a>
                                <button type="submit" class="btn btn-success pull-left">Submit</button>

                            </div>

                            <input type="hidden" name="{{ CSRF_TOKEN_NAME }}" value="{{ CSRF_TOKEN_VALUE }}"/>

                        </form>

                    </div>
                    <!-- /.modal-content -->
                </div>
                <!-- /.modal-dialog -->
            </div>
            <!-- /.modal -->

        {% else %}

            <!-- /.row -->
            <div class="col-lg-12" style="padding-top: 10px;">
                <div class="panel panel-danger">
                    <div class="panel-heading">
                        SORRY !
                    </div>
                    <!-- /.panel-heading -->
                    <div class="panel-body">
                        <p>Sorry, You are not allowed to be here !</p>
                        <a class="btn btn-default btn-lg btn-block" href="{{ urlFor( 'dashboard' ) }}">Back to Dashboard</a>
                    </div>
                    <!-- /.panel-body -->
                </div>
                <!-- /.panel -->
            </div>

        {% endif %}

    </div><!-- /.container-fluid -->
{% endblock %}

{% block footer %}
    {{ parent() }}

    {{  KO|raw }}

    <script type="text/javascript">

        $('.row').tooltip({
            selector: "[rel=tooltip]",
            container: "body"
        })

    </script>

    <script src="{{ GLOBAL_COMPONENTS }}datatables/media/js/jquery.dataTables.min.js" type="text/javascript"></script>
    <script src="{{ GLOBAL_COMPONENTS }}datatables/media/js/dataTables.bootstrap.min.js" type="text/javascript"></script>
    <script>
        $(document).ready(function() {
            $('#all-users').DataTable({
                "responsive": true,
                "stateSave": true,
                "columnDefs": [
                    { "searchable": false, "sortable": false, "targets": 0 },
                    { "searchable": false, "sortable": false, "targets": 3 },
                    { "searchable": false, "sortable": false, "targets": 4 },
                    { "searchable": false, "sortable": false, "targets": 5 }
                ]
            });
            $('#all-roles').DataTable({
                "responsive": true,
                "stateSave": true,
                "columnDefs": [
                    { "searchable": false, "sortable": false, "targets": 2 }
                ]
            });
        });
    </script>
    <script src="{{ GLOBAL_COMPONENTS }}gritter/js/jquery.gritter.min.js" type="text/javascript"></script>
    {% if errors %}
        <script>
            $.gritter.add({
                // (string | mandatory) the heading of the notification
                title: '<i class="fa fa-meh-o"></i> Something went wrong !',
                // (string | mandatory) the text inside the notification
                text: "<i>{{ errors }}</i>",
                class_name: 'gritter-alert gritter-icon'
            });
        </script>
    {% endif %}

    {% if flash.error %}

        <script>
            $.gritter.add({
                // (string | mandatory) the heading of the notification
                title: '<i class="fa fa-meh-o"></i> Something went wrong !',
                // (string | mandatory) the text inside the notification
                text: "<i>{{ flash.error }}</i>",
                class_name: 'gritter-alert gritter-icon'
            });
        </script>

    {% endif %}

    {% if flash.info %}

        <script>
            $.gritter.add({
                // (string | mandatory) the heading of the notification
                title: '<i class="fa fa-smile-o"></i> Information !',
                // (string | mandatory) the text inside the notification
                text: "<i>{{ flash.info }}</i>",
                class_name: 'gritter-facebook gritter-icon'
            });
        </script>

    {% endif %}

    {% if flash.success %}

        <script>
            $.gritter.add({
                // (string | mandatory) the heading of the notification
                title: '<i class="fa fa-smile-o"></i> Congratulations !',
                // (string | mandatory) the text inside the notification
                text: "<i>{{ flash.success }}</i>",
                class_name: 'gritter-success gritter-icon'
            });
        </script>

    {% endif %}

{% endblock %}
